<div class="d-flex flex-row mb-3 ms-4" style="min-height: 100vh; overflow: hidden;">
    <div class="ms-2" style="width: 16.66%;" id="job-search">
        <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
            <div class="mb-2">
                <label for="jobNumber" class="form-label">Enter Job Number:</label>
                <input id="jobNumber" type="text" class="form-control" formControlName="jobNumber"
                    placeholder="e.g. J12345" />
            </div>
            <button type="submit" class="btn btn-primary" [disabled]="searchForm.invalid">
                Search
            </button>
        </form>

        <!-- Optional: Display result -->
        <div *ngIf="jobData" class="mt-3">
            <h5>Job Details</h5>
            <pre>{{ jobData | json }}</pre>
        </div>
    </div> <!-- 2/12 -->
    <div style="width: 83.33%;">
        <style>
            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 12px;
            }
            th, td {
                padding: 8px;
                border: 1px solid black;
            }
            th {
                text-align: left;
            }
            .text-end, .text-right {
                text-align: right !important;
            }
            .text-center {
                text-align: center !important;
            }
            .fw-bold {
                font-weight: bold !important;
            }
        </style>
        <div style="text-align: center">
            <button
                    mat-button color="primary"
                    [printStyle]="printDivStyle"
                    printSectionId="print-job-details"
                    ngxPrint ><mat-icon>print</mat-icon>
            </button>
        </div>
        <div *ngIf="jobDetails" id="print-job-details">
            <h2>JOB Details for ID: {{jobDetails.job.job_id}}</h2>
            <h3>Bill No . {{jobDetails.bill_no}}</h3>
            <table border="1" cellpadding="8" cellspacing="0">
                <thead>
                    <tr>
                        <th>Transaction</th>
                        <th>Comment</th>
                        <th>Value (gms)</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of jobDetails.gold">
                        <td>{{ item.transaction_text }}</td>
                        <td>{{ item.comment }}</td>
                        <td class="text-end">{{ item.gold_value }}</td>
                        <td>{{ item.timestamp }}</td>
                    </tr>
                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                       <td colspan="2" class="text-center fw-bold">Gold Used</td>
                       <td class="text-end fw-bold"> {{ totalGoldUse | number:'1.3-3' }}</td>
                    </tr>
                    <tr *ngFor="let item of jobDetails.pan">
                        <td>{{ item.transaction_text }}</td>
                        <td>{{ item.comment }}</td>
                        <td class="text-end">{{ item.gold_value }}</td>
                        <td>{{ item.timestamp }}</td>
                    </tr>
                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <td colspan="2" class="text-center fw-bold">Pan Used</td>
                        <td class="text-end fw-bold"> {{ totalPanUse | number:'1.3-3' }}</td>
                    </tr>
                    <tr *ngFor="let item of jobDetails.nitric">
                        <td>{{ item.transaction_text }}</td>
                        <td>{{ item.comment }}</td>
                        <td class="text-end">{{ item.gold_value }}</td>
                        <td>{{ item.timestamp }}</td>
                    </tr>
                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <td colspan="2" class="text-end fw-bold">Nitric Used</td>
                        <td class="text-end fw-bold"> {{ totalNitricUse | number:'1.3-3' }}</td>
                    </tr>
                </tbody>
            </table>
            <h3>Final Calculation</h3>
            <table border="1" cellpadding="8" cellspacing="0">
                <thead>
                    <tr>
                        <td>Sl</td>
                        <td>Subject</td>
                        <td>Value</td>
                        <td>Job%</td>
                        <td>Bill%</td>
                        <td>Bill Value</td>
                        <td>Fine 92%</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>1</th>
                        <td>Gold Used</td>
                        <td>{{totalGoldUse | number:'1.3-3'}}</td>
                        <td>100%</td>
                        <td>100%</td>
                        <td>{{totalGoldUse | number:'1.3-3'}}</td>
                        <td class="text-end">{{totalGoldUse * 0.92 | number:'1.3-3'}}</td>
                    </tr>
                    <tr>
                        <th>2</th>
                        <td>Pan Used</td>
                        <td>{{totalPanUse | number:'1.3-3'}}</td>
                        <td>100%</td>
                        <td>40%</td>
                        <td>{{totalPanUse * jobDetails.rm_bangle_pan.bill_percentage | number:'1.3-3'}}</td>
                        <td class="text-end">{{totalPanUse * jobDetails.rm_bangle_pan.bill_percentage * 0.92 | number:'1.3-3'}}</td>
                    </tr>
                    <tr>
                        <th>3</th>
                        <td>Nitric Used</td>
                        <td>{{totalNitricUse | number:'1.3-3'}}</td>
                        <td>93%</td>
                        <td>100%</td>
                        <td>{{totalNitricUse * jobDetails.rm_nitric.job_percentage | number:'1.3-3'}}</td>
                        <td class="text-end">{{totalNitricUse * jobDetails.rm_nitric.job_percentage * 0.92 | number:'1.3-3'}}</td>
                    </tr>
                    <tr>
                        <th>4</th>
                        <td>P Loss</td>
                        <td colspan="3">{{jobDetails.job.p_loss | number:'1.3-3'}} X {{jobDetails.job.pieces}} pcs </td>
                        <td>{{totalPLoss  | number:'1.3-3'}}</td>
                        <td class="text-end">{{totalPLoss * 0.92 | number:'1.3-3'}}</td>
                    </tr>
                    <tr>
                        <th>5</th>
                        <td>MV</td>
                        <td colspan="3">{{jobDetails.job.markup_value | number:'1.3-3'}} X {{jobDetails.job.pieces}} pcs </td>
                        <td>{{totalMV  | number:'1.3-3'}}</td>
                        <td class="text-end">{{totalMV * 0.92 | number:'1.3-3'}}</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <th colspan="5">Final Bill Calculated</th>
                        <th>{{finalGini  | number:'1.3-3'}}</th>
                        <th class="text-end">{{finalGini * 0.92 | number:'1.3-3'}}</th>
                    </tr>
                </tfoot>
            </table>
        </div>

    </div> <!-- 10/12 -->
</div>
<div *ngIf="true && !isProduction" id="developer-div">
    <div class="outerContainer">
        <div fxLayout="row" fxLayoutGap="1px" fxLayout.sm="column" class="container">
            <div class="col" fxLayoutAlign="center center">
                <div class="p-3">
                    <pre>
                        jobDetails={{jobDetails | json}}
                    </pre>
                </div>
            </div>
            <div class="col" fxFlex="2 1 auto" fxLayoutAlign="center center">

            </div>
        </div>
    </div>
</div>
